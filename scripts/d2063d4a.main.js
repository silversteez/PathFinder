$(function(){window.nodes={};var a,b={},c=1e3,d=function(a){this.id=a,this.costFromStart=0,this.neighbors=[]};d.prototype.setPosition=function(){this.x=Math.floor((window.innerWidth-.2*window.innerWidth)*Math.random()+.1*window.innerWidth),this.y=Math.floor((window.innerHeight-.2*window.innerHeight)*Math.random()+.1*window.innerHeight);for(var a=0;a<this.id;a++)g(nodes[a],this)<5&&this.setPosition()},d.prototype.findNeighbors=function(){var a=function(a,c){-1===a.neighbors.indexOf(c)&&a.neighbors.push(c),-1===c.neighbors.indexOf(a)&&c.neighbors.push(a);var d=Math.min(a.id,c.id)+"-"+Math.max(a.id,c.id);b[d]=[a,c]};for(var c in nodes){var d=Math.random(),e=Math.sqrt(window.innerWidth*window.innerHeight);nodes[c]!==this&&(Math.abs(this.x-nodes[c].x)+Math.abs(this.y-nodes[c].y)<.03*e&&.6>d?a(this,nodes[c]):Math.abs(this.x-nodes[c].x)+Math.abs(this.y-nodes[c].y)<.05*e&&.4>d?a(this,nodes[c]):Math.abs(this.x-nodes[c].x)+Math.abs(this.y-nodes[c].y)<.08*e&&.3>d?a(this,nodes[c]):Math.abs(this.x-nodes[c].x)+Math.abs(this.y-nodes[c].y)<.12*e&&.2>d&&a(this,nodes[c]))}},d.prototype.createDomNode=function(a){$("<div>").addClass("node").attr("id",a).css({left:this.x-5+"px",top:this.y-5+"px"}).click(m).appendTo("body")};var e=function(){for(var a=parseInt(window.location.hash.substring(1))||300,c=0;a>c;c++)nodes[c]=new d(c);for(var e in nodes)nodes[e].setPosition(),nodes[e].findNeighbors(),nodes[e].createDomNode(e);var f=[];for(var e in b)f.push(j(b[e][0],b[e][1],"route"));$("body").append(f)},f=function(a,b){var d=[a],e=function(){if(d.sort(function(a,b){return b.totalCost-a.totalCost}),a=d.pop(),a.visited=!0,$("#"+a.id).removeClass("open changed").addClass("curNode"),a.parent&&j(a.parent,a,"possible"),a===b){console.log("path found!");for(var f=[b];a.parent;)f.push(a.parent),a=a.parent;return f.reverse(),i(f),k()}for(var l=0;l<a.neighbors.length;l++){var m=a.neighbors[l];if(m.visited||-1!==d.indexOf(m)){if(!m.visited){var n=a.costFromStart+g(a,m);n<m.costFromStart&&(m.parent=a,m.costFromStart=n,m.costToEnd=h(m,b),m.totalCost=m.costFromStart+m.costToEnd,$("#"+m.id).removeClass("open").addClass("changed"))}}else m.parent=a,m.costFromStart=a.costFromStart+g(a,m),m.costToEnd=h(m,b),m.totalCost=m.costFromStart+m.costToEnd,$("#"+m.id).addClass("open"),d.push(m)}d.length>0?setTimeout(e,c):(console.log("no path found"),k())};e()},g=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},h=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},i=function(a){j(a.pop(),a[a.length-1],"solution"),a.length>1&&setTimeout(function(){i(a)},200)},j=function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=Math.sqrt((d-f)*(d-f)+(e-g)*(e-g)),i=180*Math.atan2(g-e,f-d)/Math.PI,j="rotate("+i+"deg)",k=$("<div>");return"route"!==c&&k.appendTo("body"),k.addClass("path").addClass(c).css({transform:j}).width(h).offset({left:d,top:e}),k},k=function(){for(var a in nodes){var b=nodes[a];delete b.parent,delete b.costToEnd,delete b.totalCost,delete b.visited,b.costFromStart=0}},l=function(){$(".node").removeClass("curNode open changed"),$(".solution").remove(),$(".possible").remove(),$(".selectedNode1").remove(),$(".selectedNode2").remove(),a=void 0},m=function(b){if(b.target.id,a){if(a&&a!==nodes[b.target.id]){var c=nodes[b.target.id];$(this).clone().appendTo("body").addClass("selectedNode2"),f(a,c),a=void 0}}else a=nodes[b.target.id],$(this).clone().appendTo("body").addClass("selectedNode1")};$(".reset").click(l),$(".visSpeed").on("change",function(a){c=a.target.value}),e()});